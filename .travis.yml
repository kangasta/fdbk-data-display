language: node_js
node_js:
- lts/*
addons:
  code_climate:
    repo_token: $CODECLIMATE_TOKEN

script:
- npm run lint
- npm test -- --coverage --verbose
- echo 'PUBLIC_URL="/fdbk-data-display/"' > .env
- echo "COMMIT=\"${TRAVIS_COMMIT}\"" >> .env
- echo "TAG=\"${TRAVIS_TAG}\"" >> .env
- npm run build -- --public-url /fdbk-data-display/
- cp dist/index.html dist/404.html
after_script:
- npm install -g codeclimate-test-reporter
- codeclimate-test-reporter < coverage/lcov.info

deploy:
  provider: pages
  skip_cleanup: true
  local_dir: dist/
  github_token: $GITHUB_TOKEN
  on:
    branch: master
